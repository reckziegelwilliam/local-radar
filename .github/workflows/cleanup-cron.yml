name: Cleanup Cron Job

on:
    schedule:
        # Run every hour
        - cron: "0 * * * *"
    workflow_dispatch: # Manual trigger

jobs:
    cleanup:
        name: Cleanup Expired Events
        runs-on: ubuntu-latest

        steps:
            - name: Call Supabase cleanup function
              run: |
                  curl -X POST \
                    '${{ secrets.SUPABASE_URL }}/functions/v1/cleanup-expired-events' \
                    -H 'Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}' \
                    -H 'Content-Type: application/json' \
                    --fail

            - name: Notify on failure
              if: failure()
              run: |
                  echo "Cleanup failed! Manual intervention may be required."
                  # TODO: Add Slack/Discord notification here
